<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://www.fwilliams.info/point-cloud-utils/sections/cleaning_shapenet/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Making a ShapeNet SDF dataset - Point Cloud Utils</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Making a ShapeNet SDF dataset";
        var mkdocs_page_input_path = "sections/cleaning_shapenet.md";
        var mkdocs_page_url = "/point-cloud-utils/sections/cleaning_shapenet/";
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Point Cloud Utils
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Functionality</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../mesh_io/">Mesh and Point Cloud I/O</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../point_cloud_resampling/">Resampling Point Clouds</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../mesh_sampling/">Generating Point Samples on a Mesh</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../shape_metrics/">Point Cloud Metrics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../watertight_manifold/">Making a Mesh a Watertight Manifold</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../mesh_sdf/">Computing Signed Distances (SDFs) to Meshes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../point_cloud_normal_estimation/">Estimating Normals for Point Clouds</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../mesh_normal_estimation/">Computing Mesh Normals</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ray_mesh_intersection/">Ray/Mesh Intersection</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../surfels/">Generating Surfels from Point Clouds</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../mesh_smoothing/">Smoothing a Mesh</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../mesh_decimation/">Decimating a Mesh</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../closest_point_on_mesh/">Finding Closest Points Between Point Clouds and Meshes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../computing_connected_components_of_a_mesh/">Computing Connected Components of a Mesh</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../deduplicating_point_clouds_and_meshes/">Deduplicating Point Clouds and Meshes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../calculating_mesh_face_areas/">Calculating Mesh Face Areas</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../consistently_orienting_mesh_faces/">Consistently Orienting Mesh Faces</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../morton_coding">Morton Encoding/Decoding a Point Cloud</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Recipes</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Making a ShapeNet SDF dataset</a>
    <ul class="current">
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../api_reference/">API Reference</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Point Cloud Utils</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Recipes &raquo;</li>
      <li>Making a ShapeNet SDF dataset</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/fwilliams/point-cloud-utils/tree/master/docs/docs/sections/cleaning_shapenet.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="making-an-sdf-dataset-for-shapenet">Making an SDF Dataset for ShapeNet</h1>
<p>The code below is a simple script for making a dataset of signed distance functions for the <a href="https://shapenet.org/">ShapeNet Dataset</a>. To get started, first <a href="https://shapenet.org/login/">make an account and download ShapeNet here</a>. Once you have downloaded ShapeNet, run the script below from the root of the dataset. It loads each ShapeNet model, which may be non-watertight and non-manifold, computes a watertight and manifold mesh for that object and generates 100k points in the volume around the shape along with their corresponding signed distances. It also generates 100k points on the surface of the shape with surface normals at those points. </p>
<pre><code class="language-python">import os
import numpy as np
import point_cloud_utils as pcu

# Path to the bench category as an example
category_path = &quot;./02828884&quot;

# Resolution used to convert shapes to watertight manifolds
# Higher value means better quality and slower
manifold_resolution = 20_000

# Number of points in the volume to sample around the shape
num_vol_pts = 100_000

# Number of points on the surface to sample
num_surf_pts = 100_000

for model_path in os.listdir(category_path):
    v, f = pcu.load_mesh_vf(os.path.join(category_path, model_path, &quot;model.obj&quot;))

    # Convert mesh to watertight manifold
    vm, fm = pcu.make_mesh_watertight(v, f, manifold_resolution)
    nm = pcu.estimate_mesh_vertex_normals(vm, fm)  # Compute vertex normals for watertight mesh

    # Generate random points in the volume around the shape
    # NOTE: ShapeNet shapes are normalized within [-0.5, 0.5]^3
    p_vol = (np.random.rand(num_vol_pts, 3) - 0.5) * 1.1

    # Comput the SDF of the random points
    sdf, _, _  = pcu.signed_distance_to_mesh(p_vol, vm, fm)

    # Sample points on the surface as face ids and barycentric coordinates
    fid_surf, bc_surf = pcu.sample_mesh_random(vm, fm, num_surf_pts)

    # Compute 3D coordinates and normals of surface samples
    p_surf = pcu.interpolate_barycentric_coords(fm, fid_surf, bc_surf, vm)
    n_surf = pcu.interpolate_barycentric_coords(fm, fid_surf, bc_surf, nm)

    # Save volume points + SDF and surface points + normals
    # Load using np.load()
    npz_path = os.path.join(category_path, model_path, &quot;samples.npz&quot;)
    np.savez(npz_path, p_vol=p_vol, sdf_vol=sdf, p_surf=p_surf, n_surf=n_surf)

    # Save the watertight mesh
    watertight_mesh_path = os.path.join(category_math, model_path, &quot;model_watertight.obj&quot;)
    pcu.save_mesh_vfn(watertight_mesh_path, vm, fm, nm)
</code></pre>
<p align="center">
  <div class="row">
    <div class="column" style="float: left; width: 50%; padding: 5px;">
      <img src="../../imgs/shapenet_input_mesh.png" alt="Input ShapeNet Mesh" style="width:100%">
    </div>
    <div class="column" style="float: left; width: 50%; padding: 5px;">
      <img src="../../imgs/shapenet_watertight_mesh.png" alt="Watertight mesh extracted from ShapeNet input" style="width:100%">
    </div>
  </div>
  <div class="row">
    <div class="column" style="float: left; width: 50%; padding: 5px;">
        <img src="../../imgs/shapenet_surf_pts.png" alt="Surface points sampled from watertight mesh" style="width:100%">
    </div>
    <div class="column" style="float: left; width: 50%; padding: 5px;">
        <img src="../../imgs/shapenet_sdf_pts.png" alt="SDF Samples for watertight ShapeNet mesh" style="width:100%">
    </div>
  </div>
  <figcaption style="text-align: center; font-style: italic;"><b>Top Left:</b> Input ShapeNet mesh (not manifold or watertight), <b>Top Right:</b> Watertight manifold extracted from input ShapeNet mesh, <b>Bottom Left:</b> Points sampled on the surface of the watertight mesh, <b>Bottom Right:</b>Volume points colored by SDF for the extracted watertight shape.</figcaption>
</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../consistently_orienting_mesh_faces/" class="btn btn-neutral float-left" title="Consistently Orienting Mesh Faces"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../api_reference/" class="btn btn-neutral float-right" title="API Reference">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/fwilliams/point-cloud-utils" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../consistently_orienting_mesh_faces/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../api_reference/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../javascripts/mathjax.js" defer></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6" defer></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
